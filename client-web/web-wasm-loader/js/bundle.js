class N{_textAreaElement;_lines;_maxLines;constructor(_){this._textAreaElement=_,this._textAreaElement.value="",this._lines=[],this._maxLines=100}log(..._){if(_.length==0)return;const f=Array.prototype.slice.call(_).join(" ");console.log(f),this._pushText(f)}error(..._){if(_.length==0)return;const f=Array.prototype.slice.call(_).join(" ");console.error(f),this._pushText(`[ERR] - ${f}`)}_pushText(_){if(this._lines.push(_),this._lines.length>this._maxLines)this._lines.splice(0,this._lines.length-this._maxLines);this._textAreaElement.value=`${this._lines.join("\n")}\n`,this._textAreaElement.scrollTop=this._textAreaElement.scrollHeight}get size(){return this._lines.length}peekLast(){if(this._lines.length>0)return this._lines[this._lines.length-1];return}popLast(){if(this._lines.length>0)this._lines.splice(this._lines.length-1,1)}}var Q=N;var R=(_)=>{return new Promise((f,h)=>{const q=document.createElement("script");q.src=_,q.addEventListener("load",()=>f),q.addEventListener("error",h),document.head.appendChild(q)})};var T=()=>{return(()=>{try{if(typeof WebAssembly==="object"&&typeof WebAssembly.instantiate==="function"){const f=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(f instanceof WebAssembly.Module)return new WebAssembly.Instance(f)instanceof WebAssembly.Instance}}catch(f){}return!1})()};class J{_isInitialized=!1;_isAborted=!1;_onProgress;constructor(_){this._onProgress=_}async initialize(_,f){if(!T())throw new Error("missing WebAssembly feature (unsupported)");f.log("[JS][check] WebAssembly feature => supported");const h="wasm";return new Promise((q,K)=>{const D={downloadingDataRegExp:/Downloading data\.\.\. \(([0-9]*)\/([0-9]*)\)/,lastProgressLevel:0,locateFile:(z)=>{return`${h}/${z}`},print:(z)=>{f.log(`[C++][out] ${z}`)},printErr:(z)=>{f.error(`[C++][err] ${z}`)},setStatus:(z)=>{if(!z)return;const B=D.downloadingDataRegExp.exec(z);if(B){const V=parseFloat(B[1]),X=parseFloat(B[2]),G=Math.floor(V/X*100);if(D.lastProgressLevel!==G)D.lastProgressLevel=G,this._onProgress(G)}else f.log(`[JS][wasm][status] ${z}`)},onRuntimeInitialized:()=>{f.log("[JS][wasm] loaded"),f.log("[JS][wasm] initializing");const z={startApplication:window.Module.cwrap("startApplication",void 0,["number"])},B=window.Module.allocateUTF8(_);z.startApplication(B),window.Module._free(B),this._isInitialized=!0,f.log("[JS][wasm] initialized"),q()},noInitialRun:!0,noExitRuntime:!0};window.Module=D,f.log("[JS][wasm] loading"),R(`./${h}/client.js`).catch(K)})}abort(){if(!this._isInitialized||this._isAborted)return;this._isAborted=!0;const _=window.Module;if(_)_.setStatus=(f)=>{if(f)console.error(`[JS][wasm][aborted] ${f}`)}}}var Y=(_)=>{const f=document.querySelector(_);if(!f)throw new Error(`DOM elements not found, id: "${_}"`);return f},Z=async(_)=>{try{const h=await(await fetch("/web-socket-config.json")).json();return _.log(`[JS] config from server: "${JSON.stringify(h)}"`),h.webSocketUrl}catch(f){throw _.error("[JS] fail to fetch the websocket config from server"),_.error(`[JS] -> message: "${f}"`),f}},$=async()=>{const _=Y("#loggerOutput"),f=new Q(_);f.log("[JS] page loaded");const h=(z)=>{f.error(`[JS] exception, event=${z}`)};window.addEventListener("error",h);const q=await Z(f);f.log(`[JS] websocketUrl: "${q}"`);const D=new J((z)=>{const B=`Loading wasm [${z}%]`;if(f.size>0&&f.peekLast().indexOf("Loading wasm [")>=0)f.popLast();f.log(`[JS] ${B}`)});try{await D.initialize(q,f)}catch(z){throw f.error("[JS] failed to initialize the wasm application"),f.error(`[JS] -> message: "${z.message}"`),z}};window.addEventListener("load",$);
